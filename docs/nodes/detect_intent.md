# detect_intent.py

## 功能說明

`detect_intent.py` 是金融語意分類模組，專門用於分析使用者提問的意圖和投資面向。此模組能夠：

1. **問題大分類**：識別問題的主要類別（個股分析、選股建議、盤勢分析等）
2. **問題子分類**：進一步細分問題類型（可複選）
3. **投資面向判斷**：判斷問題涉及的投資面向（籌碼面、技術面、基本面、無明確面向）

## 主要函數

### `detect_intent(question: str, model: str = "gpt-3.5-turbo") -> str`
- **功能**：分析使用者問題的意圖和投資面向
- **參數**：
  - `question`: 使用者提問
  - `model`: OpenAI 模型（預設 gpt-3.5-turbo）
- **返回**：結構化的分類結果

## Prompt 設計

### 問題大分類
系統將問題分為 7 大類：

1. **個股分析**：針對特定股票的分析
2. **選股建議**：股票篩選和推薦
3. **盤勢分析**：大盤和市場分析
4. **比較分析**：多檔股票或產業比較
5. **複雜問題查找**：多層條件查詢
6. **金融知識詢問**：金融概念和制度說明
7. **無效問題**：排除不合理的預測性問題

### 投資面向
- **籌碼面**：法人動向、大戶散戶、股權分散等
- **技術面**：K線、均線、技術指標等
- **基本面**：財務指標、營收獲利、產業地位等
- **無明確面向**：問題沒有特別偏向某個面向

### 輸出格式
```
---
問題：「使用者問題」

問題大分類：[大分類]  
問題子分類：[子分類]  
投資面向：[投資面向]
---
```

## Input/Output 範例

### 輸入範例
```python
question = "最近投信買最多的是哪幾檔 AI 概念股？"
```

### 輸出範例
```
---
問題：「最近投信買最多的是哪幾檔 AI 概念股？」

問題大分類：[選股建議]  
問題子分類：[法人追蹤選股]  
投資面向：[籌碼面]
---
```

### 測試案例

#### 案例 1：選股建議
**輸入**：`"最近投信買最多的是哪幾檔 AI 概念股？"`
**輸出**：
```
問題大分類：[選股建議]  
問題子分類：[法人追蹤選股]  
投資面向：[籌碼面]
```

#### 案例 2：無效問題
**輸入**：`"你覺得士電明天會漲嗎？"`
**輸出**：
```
問題大分類：[無效問題]  
問題子分類：[不合理預測]  
投資面向：[無明確面向]
```

#### 案例 3：比較分析
**輸入**：`"請幫我比較長榮與華航的近期營收與股價表現"`
**輸出**：
```
問題大分類：[比較分析]  
問題子分類：[兩檔個股比較]  
投資面向：[基本面]
```

## 使用場景

1. **問題預處理**：在主要分析前先分類問題類型
2. **路由決策**：根據問題類型選擇合適的處理流程
3. **投資面向判斷**：確定需要分析的投資面向
4. **無效問題過濾**：排除不合理的預測性問題

## 錯誤處理

- **API 錯誤**：返回錯誤訊息並記錄
- **解析失敗**：返回預設分類結果

## 擴充性

- 可新增更多問題分類
- 可調整子分類的細分程度
- 可支援更多投資面向
- 可自訂輸出格式

## 與其他模組的關係

- **前置模組**：通常在其他分析模組之前執行
- **路由模組**：為後續的處理流程提供分類資訊
- **整合模組**：與 `classify_and_extract.py` 功能類似，但更專注於語意分類 