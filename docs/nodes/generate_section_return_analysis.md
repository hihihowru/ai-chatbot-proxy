# generate_section_return_analysis.py

## åŠŸèƒ½èªªæ˜

`generate_section_return_analysis.py` æ˜¯å ±é…¬ç‡çµ±è¨ˆåˆ†ææ¨¡çµ„ï¼Œå°ˆé–€ç”¨æ–¼åˆ†æè‡ªé¸è‚¡çš„æ•´é«”å ±é…¬ç‡çµ±è¨ˆè³‡æ–™ã€‚æ­¤æ¨¡çµ„èƒ½å¤ ï¼š

1. **çµ±è¨ˆåˆ†æ**ï¼šè¨ˆç®—å„æœŸé–“çš„ä¸Šæ¼²/ä¸‹è·Œå®¶æ•¸ã€å¹³å‡å ±é…¬ç‡
2. **æ¥µå€¼åˆ†æ**ï¼šæ‰¾å‡ºæœ€å¤§æ¼²å¹…å’Œæœ€å¤§è·Œå¹…çš„è‚¡ç¥¨
3. **è¡¨æ ¼å‘ˆç¾**ï¼šä»¥çµæ§‹åŒ–è¡¨æ ¼é¡¯ç¤ºçµ±è¨ˆçµæœ
4. **è³‡æ–™æ•´åˆ**ï¼šæ•´åˆä¾†è‡ªè‚¡åƒ¹æ‘˜è¦æ¨¡çµ„çš„è³‡æ–™
5. **è¦–è¦ºåŒ–æº–å‚™**ï¼šæä¾›è³‡æ–™ä¾›å‰ç«¯ç¹ªè£½åœ–è¡¨

## ä¸»è¦å‡½æ•¸

### `generate_return_analysis_section(price_data: List[Dict]) -> Dict[str, Any]`
- **åŠŸèƒ½**ï¼šç”¢ç”Ÿå ±é…¬ç‡çµ±è¨ˆåˆ†æ section
- **åƒæ•¸**ï¼š
  - `price_data`: è‚¡åƒ¹æ‘˜è¦è³‡æ–™ï¼ˆä¾†è‡ª generate_price_summary_sectionï¼‰
- **è¿”å›**ï¼šåŒ…å« successã€sectionã€analysis_data çš„å­—å…¸

## åˆ†ææœŸé–“

### çµ±è¨ˆæœŸé–“
- **1æ—¥å ±é…¬**ï¼šéå»ä¸€æ—¥æ¼²è·Œçµ±è¨ˆ
- **5æ—¥å ±é…¬**ï¼šéå»ä¸€é€±æ¼²è·Œçµ±è¨ˆ
- **20æ—¥å ±é…¬**ï¼šéå»ä¸€æœˆæ¼²è·Œçµ±è¨ˆ

### çµ±è¨ˆæŒ‡æ¨™
- **ä¸Šæ¼²å®¶æ•¸**ï¼šå ±é…¬ç‡ > 0 çš„è‚¡ç¥¨æ•¸é‡
- **ä¸‹è·Œå®¶æ•¸**ï¼šå ±é…¬ç‡ < 0 çš„è‚¡ç¥¨æ•¸é‡
- **å¹³å‡å ±é…¬ç‡**ï¼šæ‰€æœ‰è‚¡ç¥¨çš„å¹³å‡å ±é…¬ç‡
- **æœ€å¤§æ¼²å¹…**ï¼šæœ€é«˜å ±é…¬ç‡åŠå…¶å°æ‡‰è‚¡ç¥¨
- **æœ€å¤§è·Œå¹…**ï¼šæœ€ä½å ±é…¬ç‡åŠå…¶å°æ‡‰è‚¡ç¥¨

## Input/Output ç¯„ä¾‹

### è¼¸å…¥ç¯„ä¾‹
```python
price_data = [
    {
        "stock_id": "2330",
        "company_name": "å°ç©é›»",
        "1æ—¥å ±é…¬": 1.2,
        "5æ—¥å ±é…¬": 3.5,
        "20æ—¥å ±é…¬": 8.7
    },
    {
        "stock_id": "2303",
        "company_name": "è¯é›»",
        "1æ—¥å ±é…¬": -0.8,
        "5æ—¥å ±é…¬": 2.1,
        "20æ—¥å ±é…¬": 5.3
    }
]
```

### è¼¸å‡ºç¯„ä¾‹
```json
{
  "success": true,
  "section": {
    "title": "å ±é…¬ç‡çµ±è¨ˆåˆ†æ",
    "content": "ğŸ“Š å ±é…¬ç‡çµ±è¨ˆåˆ†æ\n\tâ€¢\t**éå»ä¸€æ—¥ï¼š**ä¸Šæ¼² 1 æª”ï¼Œä¸‹è·Œ 1 æª”\n\tâ€¢\tå¹³å‡ä¸€é€±æ¼²å¹…ï¼š+2.8%\n\tâ€¢\t**æœ€å¤§æ¼²å¹…ï¼š**å°ç©é›»ï¼ˆ+3.5%ï¼Œ5 æ—¥ï¼‰\n\tâ€¢\t**æœ€å¤§æ¼²å¹…ï¼š**å°ç©é›»ï¼ˆ+8.7%ï¼Œ20 æ—¥ï¼‰",
    "cards": [
      {
        "title": "å ±é…¬ç‡çµ±è¨ˆ",
        "content": "ğŸ“Š å ±é…¬ç‡çµ±è¨ˆåˆ†æ...",
        "type": "text"
      },
      {
        "title": "è©³ç´°çµ±è¨ˆè¡¨æ ¼",
        "content": "å ±é…¬ç‡çµ±è¨ˆè©³æƒ…\n\næœŸé–“\tä¸Šæ¼²æª”æ•¸\tä¸‹è·Œæª”æ•¸\tå¹³å‡å ±é…¬\tæœ€å¤§æ¼²å¹…\tæœ€å¤§è·Œå¹…\n1æ—¥\t1\t1\t+0.2%\t+1.2%\t-0.8%\n5æ—¥\t2\t0\t+2.8%\t+3.5%\t+2.1%\n20æ—¥\t2\t0\t+7.0%\t+8.7%\t+5.3%",
        "type": "table",
        "data": {
          "1æ—¥å ±é…¬": {
            "up_count": 1,
            "down_count": 1,
            "avg_return": 0.2,
            "max_return": 1.2,
            "min_return": -0.8,
            "max_stock": {"stock_id": "2330", "company_name": "å°ç©é›»"},
            "min_stock": {"stock_id": "2303", "company_name": "è¯é›»"}
          }
        }
      }
    ],
    "sources": [
      {
        "name": "Finlab æ”¶ç›¤åƒ¹è³‡æ–™",
        "url": "https://finlab.tw/",
        "description": "å°è‚¡æ”¶ç›¤åƒ¹æ­·å²è³‡æ–™"
      }
    ]
  },
  "analysis_data": {
    "1æ—¥å ±é…¬": {
      "up_count": 1,
      "down_count": 1,
      "flat_count": 0,
      "avg_return": 0.2,
      "max_return": 1.2,
      "min_return": -0.8,
      "max_stock": {"stock_id": "2330", "company_name": "å°ç©é›»"},
      "min_stock": {"stock_id": "2303", "company_name": "è¯é›»"},
      "total_count": 2
    }
  }
}
```

## çµ±è¨ˆé‚è¼¯

### è³‡æ–™è™•ç†
1. **æœ‰æ•ˆè³‡æ–™ç¯©é¸**ï¼šåªçµ±è¨ˆæœ‰å ±é…¬ç‡è³‡æ–™çš„è‚¡ç¥¨
2. **æ•¸å€¼è¨ˆç®—**ï¼šä½¿ç”¨ numpy é€²è¡Œçµ±è¨ˆè¨ˆç®—
3. **æ¥µå€¼è­˜åˆ¥**ï¼šæ‰¾å‡ºæœ€å¤§æ¼²å¹…å’Œæœ€å¤§è·Œå¹…çš„è‚¡ç¥¨
4. **æ ¼å¼åŒ–è¼¸å‡º**ï¼šä¿ç•™ä¸€ä½å°æ•¸ï¼Œæ­£æ•¸å‰åŠ  "+" è™Ÿ

### çµ±è¨ˆå…¬å¼
- **ä¸Šæ¼²å®¶æ•¸**ï¼š`np.sum(returns > 0)`
- **ä¸‹è·Œå®¶æ•¸**ï¼š`np.sum(returns < 0)`
- **å¹³å‡å ±é…¬ç‡**ï¼š`np.mean(returns)`
- **æœ€å¤§æ¼²å¹…**ï¼š`np.max(returns)`
- **æœ€å¤§è·Œå¹…**ï¼š`np.min(returns)`

## è¡¨æ ¼æ ¼å¼

### çµ±è¨ˆè¡¨æ ¼çµæ§‹
```
æœŸé–“    ä¸Šæ¼²æª”æ•¸    ä¸‹è·Œæª”æ•¸    å¹³å‡å ±é…¬    æœ€å¤§æ¼²å¹…    æœ€å¤§è·Œå¹…
1æ—¥     1          1          +0.2%       +1.2%       -0.8%
5æ—¥     2          0          +2.8%       +3.5%       +2.1%
20æ—¥    2          0          +7.0%       +8.7%       +5.3%
```

### æ–‡å­—æ‘˜è¦æ ¼å¼
```
ğŸ“Š å ±é…¬ç‡çµ±è¨ˆåˆ†æ
    â€¢ éå»ä¸€æ—¥ï¼šä¸Šæ¼² 1 æª”ï¼Œä¸‹è·Œ 1 æª”
    â€¢ å¹³å‡ä¸€é€±æ¼²å¹…ï¼š+2.8%
    â€¢ æœ€å¤§æ¼²å¹…ï¼šå°ç©é›»ï¼ˆ+3.5%ï¼Œ5 æ—¥ï¼‰
```

## éŒ¯èª¤è™•ç†

### è³‡æ–™é©—è­‰
- æª¢æŸ¥ price_data æ˜¯å¦ç‚ºç©º
- é©—è­‰è³‡æ–™æ ¼å¼æ˜¯å¦æ­£ç¢º
- è™•ç†ç„¡æ•ˆçš„å ±é…¬ç‡è³‡æ–™

### è¨ˆç®—ç•°å¸¸
- è™•ç† NaN æˆ–ç„¡æ•ˆæ•¸å€¼
- æ•ç²çµ±è¨ˆè¨ˆç®—éŒ¯èª¤
- è¨˜éŒ„éŒ¯èª¤è¨Šæ¯

## æ“´å……æ€§

### æ–°å¢çµ±è¨ˆæœŸé–“
- å¯èª¿æ•´ periods åˆ—è¡¨
- æ–°å¢æ›´å¤šæ™‚é–“å€é–“
- è‡ªè¨‚çµ±è¨ˆæŒ‡æ¨™

### è¦–è¦ºåŒ–æ”¯æ´
- æä¾›çµæ§‹åŒ–è³‡æ–™ä¾›å‰ç«¯ç¹ªåœ–
- æ”¯æ´å¤šç¨®åœ–è¡¨é¡å‹
- å¯æ“´å……äº’å‹•åŠŸèƒ½

### åˆ†ææ·±åº¦
- å¯æ–°å¢æ›´å¤šçµ±è¨ˆæŒ‡æ¨™
- æ”¯æ´åˆ†çµ„åˆ†æ
- åŠ å…¥è¶¨å‹¢åˆ†æ 